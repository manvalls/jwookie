(function(e){function h(){var a;if(!m)if(y.length){var b=y.shift();m=!0;wit.apply(b[0],b[1])(function(){m=!1;h();b[2]()})}else if(n.length){var k=n;n=[];for(a=0;a<k.length;a++)k[a]();return h()}}function A(a,b){return function(k){y.push([a,b,k||function(){}]);h()}}function v(a){a=a||{};var b=a.url||location.href;b=b.replace(/#.*$/,"");b=B(b);var k=a.method||"GET";var c=a.headers||{};var d=a.body||null;var f=a.uploadHandler||function(){};var z=a.asynchronous||!1;var p=a.refresh||!1;var q=a.key||{};return function(a){n.push(function(){function h(a){a=a.b;setTimeout(a.onerror,0,Error("Aborted"));a.onload=a.onerror=null;a.abort()}function n(a){a=t.indexOf(a);-1!=a&&t.splice(a,1)}var g,m;a=a||function(){};if(z){var u=t;for(g=0;g<u.length;g++){var r=u[g];if(!r.a){setTimeout(a,0,Error("Aborted"));return}r.key===q&&(n(r),h(r))}}else for(u=t,t=[],g=0;g<u.length;g++)h(u[g]);var l=new XMLHttpRequest;r={b:l,a:z,key:q};t.push(r);f(l.upload);l.onload=function(){n(r);try{var d=JSON.parse(l.responseText)}catch(G){return a(G)}var c=l.responseURL||l.getResponseHeader("X-Response-Url")||b;c=B(c);!z&&e.history&&history.pushState&&history.replaceState&&c!=location.href&&(p?history.replaceState({__wookie:!0},"",c):history.pushState({__wookie:!0},"",c));A(d,void 0)(a)};l.onerror=function(b){n(r);a(b)};l.open(k,b,!0);l.setRequestHeader("Accept","application/json");if(e.wok)for(g in wok)if(wok.hasOwnProperty(g))for(m in wok[g])wok[g].hasOwnProperty(m)&&l.setRequestHeader(m,wok[g][m]);for(g in c)c.hasOwnProperty(g)&&l.setRequestHeader(g,c[g]);l.send(d)});h()}}function C(a,b,k,c){var d;for(d=0;d<a.attributes.length;d++){var f=a.attributes[d];var e=f.name.indexOf(b);var h=f.name.indexOf(k);0==e&&h==f.name.length-k.length&&(c[f.name.slice(e+b.length,h)]=f.value)}}function D(a){var b={};a.preventDefault();C(this,"data-","-header",b);w.trigger(this);v({url:this.href,headers:b,asynchronous:null!=this.getAttribute("data-async")})(function(a){x.trigger(this,a)})}function E(a){var b={},e;a.preventDefault();C(this,"data-","-header",b);a=this.action||location.href;a=a.replace(/#.*$/,"");if(this.method&&"get"!=this.method.toLowerCase())var c=new FormData(this);else{var d=[];c=null;for(e=0;e<this.elements.length;e++){var f=this.elements[e];if(f.hasAttribute("name"))switch(f.type.toLowerCase()){case "radio":case "checkbox":if(!f.checked)break;default:d.push(encodeURIComponent(f.name)+(f.value?"="+encodeURIComponent(f.value):""))}}a=-1!=a.indexOf("?")?a+("&"+d.join("&")):a+("?"+d.join("&"))}w.trigger(this);v({url:a,headers:b,method:this.method,body:c,asynchronous:null!=this.getAttribute("data-async")})(function(a){x.trigger(this,a)})}function F(a){var b=a.querySelectorAll("form[data-wk]"),k=a.querySelectorAll("[data-wkrun]");a=a.querySelectorAll("a[data-wk]");var c;for(c=0;c<a.length;c++){var d=a[c];d.addEventListener?d.addEventListener("click",D,!1):d.attachEvent&&d.attachEvent("onclick",D)}if(e.FormData)for(a=0;a<b.length;a++)c=b[a],c.addEventListener?c.addEventListener("submit",E,!1):c.attachEvent&&c.attachEvent("onsubmit",E);for(b=0;b<k.length;b++)if(d=k[b].getAttribute("data-run").split("?"),d[0]){a=d[0].split(".");c={};if(d[1]){var f=d[1].split("&");for(d=0;d<f.length;d++){var h=f[d].split("=");h[0]&&(c[decodeURIComponent(h[0])]=decodeURIComponent(h[1]||""))}}wit.call(a,c,k[b])}}function p(){e.removeEventListener?(e.removeEventListener("load",p,!1),document.removeEventListener("DOMContentLoaded",p,!1)):e.detachEvent&&e.detachEvent("onload",p);wit.beforeMount.subscribe(F);F(document);m=!1;h()}var q=e.wookie=e.wookie||{},y=[],n=[],m=!0,w=wit.event(),x=wit.event(),t=[],B=function(){var a;return function(b){a||(a=document.createElement("a"));a.href=b;return a.href}}();e.addEventListener&&e.addEventListener("popstate",function(){history.state&&history.state.__wookie&&(w.trigger(document.documentElement,"popstate"),v({refresh:!0})(function(a){x.trigger(document.documentElement,a,"popstate")}))},!1);q.apply=A;q.request=v;q.queue=function(a){n.push(function(){setTimeout(a,0)});h()};q.loading=w;q.loaded=x;setTimeout(function(){"complete"==document.readyState?p():e.addEventListener?(e.addEventListener("load",p,!1),document.addEventListener("DOMContentLoaded",p,!1)):e.attachEvent&&e.attachEvent("onload",p)},0);"undefined"!=typeof module&&(module.exports=q)})("undefined"==typeof window?self:window);
