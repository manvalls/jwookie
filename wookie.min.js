(function(h){function q(){var a;if(!A)if(C.length){var c=C.shift();A=!0;wit.apply(c[0],c[1])(function(){A=!1;q();c[2]()})}else if(v.length){var b=v;v=[];for(a=0;a<b.length;a++)b[a]();return q()}}function E(a,c){return function(b){C.push([a,c,b||function(){}]);q()}}function w(a){a=a||{};var c=a.url||location.href;c=c.replace(/#.*$/,"");c=F(c);var b=a.method||"GET";var d=a.headers||{};var e=a.body||null;var k=a.uploadHandler||function(){};var f=a.asynchronous||!1;var g=a.refresh||!1;var G=a.key||{};return function(a){v.push(function(){function r(a){a=a.c;setTimeout(a.onerror,0,Error("Aborted"));a.onload=a.onerror=null;a.abort()}function q(a){a=u.indexOf(a);-1!=a&&u.splice(a,1)}var l,p;a=a||function(){};if(f){var n=u;for(l=0;l<n.length;l++){var t=n[l];if(!t.b){setTimeout(a,0,Error("Aborted"));return}t.key===G&&(q(t),r(t))}}else for(n=u,u=[],l=0;l<n.length;l++)r(n[l]);var m=new XMLHttpRequest;t={c:m,b:f,key:G};u.push(t);k(m.upload);m.onload=function(){q(t);try{var b=JSON.parse(m.responseText)}catch(N){return a(N)}var d=m.responseURL||m.getResponseHeader("X-Response-Url")||c;d=F(d);!f&&h.history&&history.pushState&&history.replaceState&&d!=location.href&&(g?history.replaceState({__wookie:!0},"",d):history.pushState({__wookie:!0},"",d));E(b,void 0)(a)};m.onerror=function(b){q(t);a(b)};m.open(b,c,!0);m.setRequestHeader("Accept","application/json");f&&m.setRequestHeader("X-Async","true");if(h.wok)for(l in wok)if(wok.hasOwnProperty(l))for(p in wok[l])wok[l].hasOwnProperty(p)&&m.setRequestHeader(p,wok[l][p]);for(l in d)d.hasOwnProperty(l)&&m.setRequestHeader(l,d[l]);m.send(e)});q()}}function x(a,c,b,d){var e;for(e=0;e<a.attributes.length;e++){var k=a.attributes[e];var f=k.name.indexOf(c);var g=k.name.indexOf(b);0==f&&g==k.name.length-b.length&&(d[k.name.slice(f+c.length,g)]=k.value)}}function H(a){var c;if("select"==a.tagName.toLowerCase()){var b=[];for(c=0;c<a.options.length;c++)a.options[c].selected&&b.push(a.options[c].value);return b}return[a.value]}function B(a,c,b){var d,e;if(a)var k=[];else if(c)var f=new FormData;else return new FormData(b);for(d=0;d<b.elements.length;d++){var g=b.elements[d];if(g.hasAttribute("name"))switch(g.type.toLowerCase()){case "radio":case "checkbox":if(!g.checked)break;default:if(!c||-1!=c.indexOf(g.name)){var h=H(g);for(e=0;e<h.length;e++)a?k.push(encodeURIComponent(g.name)+(h[e]?"="+encodeURIComponent(h[e]):"")):f.append(g.name,h[e])}}}return a?a.replace(/\?.*$/,"")+"?"+k.join("&"):f}function O(a){var c={};this.target&&"_self"!=this.target||(a.preventDefault(),x(this,"data-","-header",c),y.trigger(this),w({url:this.href,headers:c,asynchronous:null!=this.getAttribute("data-async")})(function(a){z.trigger(this,a)}))}function P(a){var c={},b=this.__wookie_lastClickedSubmit;if(!(this.target&&"_self"!=this.target||b&&b.formTarget&&"_self"!=b.formTarget)){x(this,"data-","-header",c);b&&x(b,"data-","-header",c);var d=b&&b.formMethod||this.method||"GET";var e=b&&b.formAction||this.action||location.href;e=e.replace(/#.*$/,"");if("get"==d.toLowerCase()){var k=null;e=B(e,null,this)}else{if(!h.FormData)return;if(b&&b.a){var f=this.encoding;this.encoding=b.a}k=B(null,null,this);b&&b.a&&(this.encoding=f)}a.preventDefault();y.trigger([this]);w({url:e,headers:c,method:d,body:k,asynchronous:null!=this.getAttribute("data-async")||b&&null!=b.getAttribute("data-async")})(function(a){z.trigger([this],a)})}}function Q(){this.form&&(this.form.__wookie_lastClickedSubmit=this)}function R(){I.call(this)}function I(){this.__wookie_committed=!0;D(this,!1)}function J(a){return null!=a.getAttribute("data-commitonly")||null!=a.getAttribute("data-waitcommit")&&!a.__wookie_committed?!1:!0}function S(){J(this)&&D(this,!1)}function T(a,c){var b;if(a===c)return!0;if(!a||!c||a.length!=c.length)return!1;for(b=0;b<a.length;b++)if(a[b]!==c[b])return!1;return!0}function K(a){var c=[],b;for(b in a)a.hasOwnProperty(b)&&c.push(b);return c}function L(a){a=a.getAttribute("data-dependencies");var c,b;if(null==a)return[];a=a.split(/\s+/);var d=[];for(c=0;c<a.length;c++)(b=decodeURIComponent(a[c]))&&d.push(b);return d}function D(a,c){var b,d;clearTimeout(a.__wookie_debounceTimeout);delete a.__wookie_debounceTimeout;if((b=a.getAttribute("data-debounce")||a.form&&a.form.getAttribute("data-debounce"))&&!c)a.__wookie_debounceTimeout=setTimeout(D,parseInt(b,10),a,!0);else if(b=H(a),(a.__wookie_lastChecked!==a.checked||!T(a.__wookie_lastValues,b))&&a.form&&a.name){a.__wookie_lastChecked=a.checked;a.__wookie_lastValues=b;var e={};b={};var k=[a];e[a.name]=!0;b[a.name]=!0;var f=L(a);for(d=0;d<f.length;d++)e[f[d]]=!0;for(d=0;d<a.form.elements.length;d++){var g=a.form.elements[d];if(null!=g.getAttribute("data-wk")&&g.name&&J(g)&&(f=L(g),-1!=f.indexOf(a.name)))for(-1==k.indexOf(g)&&k.push(g),e[g.name]=!0,b[g.name]=!0,g=0;g<f.length;g++)e[f[g]]=!0}e=K(e);d=K(b);b={};b["X-Live"]=d.join(",");x(a.form,"data-","-header",b);x(a.form,"data-","-liveheader",b);d=a.form.getAttribute("data-livemethod")||a.form.method||"GET";f=a.form.getAttribute("data-liveaction")||a.form.action||location.href;f=f.replace(/#.*$/,"");if("get"==d.toLowerCase())g=null,f=B(f,e,a.form);else{if(!h.FormData)return;g=B(null,e,a.form)}y.trigger(k);w({url:f,headers:b,method:d,body:g,asynchronous:null!=a.form.getAttribute("data-async")||null!=a.form.getAttribute("data-liveasync")})(function(a){z.trigger(k,a)})}}function p(a,c,b){var d;for(d=0;d<a.length;d++){var e=a[d];e.addEventListener?e.addEventListener(c,b,!1):e.attachEvent&&e.attachEvent("on"+c,b)}}function M(a){var c=a.querySelectorAll("form[data-wk]"),b=a.querySelectorAll("input[type=submit], button[type=submit], input[type=image]"),d=a.querySelectorAll("input[data-wk], textarea[data-wk], select[data-wk]"),e=a.querySelectorAll("[data-wkrun]");p(a.querySelectorAll("a[data-wk]"),"click",O);p(c,"submit",P);p(b,"click",Q);p(d,"blur",I);p(d,"change",R);p(d,"input",S);for(a=0;a<e.length;a++)if(d=e[a].getAttribute("data-run").split("?"),d[0]){c=d[0].split(".");b={};if(d[1]){var h=d[1].split("&");for(d=0;d<h.length;d++){var f=h[d].split("=");f[0]&&(b[decodeURIComponent(f[0])]=decodeURIComponent(f[1]||""))}}wit.call(c,b,e[a])}}function r(){h.removeEventListener?(h.removeEventListener("load",r,!1),document.removeEventListener("DOMContentLoaded",r,!1)):h.detachEvent&&h.detachEvent("onload",r);wit.beforeMount.subscribe(M);M(document);A=!1;q()}var n=h.wookie=h.wookie||{},C=[],v=[],A=!0,y=wit.event(),z=wit.event(),u=[],F=function(){var a;return function(c){a||(a=document.createElement("a"));a.href=c;return a.href}}();h.addEventListener&&h.addEventListener("popstate",function(){history.state&&history.state.__wookie&&(y.trigger(document.documentElement,"popstate"),w({refresh:!0})(function(a){z.trigger(document.documentElement,a,"popstate")}))},!1);n.apply=E;n.request=w;n.queue=function(a){v.push(function(){setTimeout(a,0)});q()};n.loading=y;n.loaded=z;setTimeout(function(){"complete"==document.readyState?r():h.addEventListener?(h.addEventListener("load",r,!1),document.addEventListener("DOMContentLoaded",r,!1)):h.attachEvent&&h.attachEvent("onload",r)},0);"undefined"!=typeof module&&(module.exports=n)})("undefined"==typeof window?self:window);
