(function(e){function h(){var a;if(!k)if(y.length){var b=y.shift();k=!0;wit.apply(b[0])(function(){k=!1;h();b[1]()})}else if(m.length){var r=m;m=[];for(a=0;a<r.length;a++)r[a]();return h()}}function A(a){return function(b){y.push([a,b||function(){}]);h()}}function v(a){a=a||{};var b=a.url||location.href;b=b.replace(/#.*$/,"");b=B(b);var r=a.method||"GET";var c=a.headers||{};var d=a.body||null;var f=a.uploadHandler||function(){};var z=a.asynchronous||!1;var n=a.refresh||!1;var p=a.key||{};return function(a){m.push(function(){function h(a){a=a.b;setTimeout(a.onerror,0,Error("Aborted"));a.onload=a.onerror=null;a.abort()}function m(a){a=t.indexOf(a);-1!=a&&t.splice(a,1)}var g,k;a=a||function(){};if(z){var u=t;for(g=0;g<u.length;g++){var q=u[g];if(!q.a){setTimeout(a,0,Error("Aborted"));return}q.key===p&&(m(q),h(q))}}else for(u=t,t=[],g=0;g<u.length;g++)h(u[g]);var l=new XMLHttpRequest;q={b:l,a:z,key:p};t.push(q);f(l.upload);l.onload=function(){m(q);try{var d=JSON.parse(l.responseText)}catch(G){return a(G)}var c=l.responseURL||l.getResponseHeader("X-Response-Url")||b;c=B(c);!z&&e.history&&history.pushState&&history.replaceState&&c!=location.href&&(n?history.replaceState({__wookie:!0},"",c):history.pushState({__wookie:!0},"",c));A(d)(a)};l.onerror=function(b){m(q);a(b)};l.open(r,b,!0);l.setRequestHeader("Accept","application/json");if(e.wok)for(g in wok)if(wok.hasOwnProperty(g))for(k in wok[g])wok[g].hasOwnProperty(k)&&l.setRequestHeader(k,wok[g][k]);for(g in c)c.hasOwnProperty(g)&&l.setRequestHeader(g,c[g]);l.send(d)});h()}}function C(a,b,r,c){var d;for(d=0;d<a.attributes.length;d++){var f=a.attributes[d];var e=f.name.indexOf(b);var h=f.name.indexOf(r);0==e&&h==f.name.length-r.length&&(c[f.name.slice(e+b.length,h)]=f.value)}}function D(a){var b={};a.preventDefault();C(this,"data-","-header",b);w.trigger(this);v({url:this.href,headers:b,asynchronous:null!=this.getAttribute("data-async")})(function(a){x.trigger(this,a)})}function E(a){var b={},e;a.preventDefault();C(this,"data-","-header",b);a=this.action||location.href;a=a.replace(/#.*$/,"");if(this.method&&"get"!=this.method.toLowerCase())var c=new FormData(this);else{var d=[];c=null;for(e=0;e<this.elements.length;e++){var f=this.elements[e];if(f.hasAttribute("name"))switch(f.type.toLowerCase()){case "radio":case "checkbox":if(!f.checked)break;default:d.push(encodeURIComponent(f.name)+(f.value?"="+encodeURIComponent(f.value):""))}}a=-1!=a.indexOf("?")?a+("&"+d.join("&")):a+("?"+d.join("&"))}w.trigger(this);v({url:a,headers:b,method:this.method,body:c,asynchronous:null!=this.getAttribute("data-async")})(function(a){x.trigger(this,a)})}function F(a){var b=a.querySelectorAll("form[data-wk]"),h=a.querySelectorAll("[data-wkrun]");a=a.querySelectorAll("a[data-wk]");var c;for(c=0;c<a.length;c++){var d=a[c];d.addEventListener?d.addEventListener("click",D,!1):d.attachEvent&&d.attachEvent("onclick",D)}if(e.FormData)for(a=0;a<b.length;a++)c=b[a],c.addEventListener?c.addEventListener("submit",E,!1):c.attachEvent&&c.attachEvent("onsubmit",E);for(b=0;b<h.length;b++)if(d=h[b].getAttribute("data-run").split("?"),d[0]){a=d[0].split(".");c={};if(d[1]){var f=d[1].split("&");for(d=0;d<f.length;d++){var k=f[d].split("=");k[0]&&(c[decodeURIComponent(k[0])]=decodeURIComponent(k[1]||""))}}wit.call(a,c,h[b])}}function n(){e.removeEventListener?(e.removeEventListener("load",n,!1),document.removeEventListener("DOMContentLoaded",n,!1)):e.detachEvent&&e.detachEvent("onload",n);wit.beforeMount.subscribe(F);F(document);k=!1;h()}var p=e.wookie=e.wookie||{},y=[],m=[],k=!0,w=wit.event(),x=wit.event(),t=[],B=function(){var a;return function(b){a||(a=document.createElement("a"));a.href=b;return a.href}}();e.addEventListener&&e.addEventListener("popstate",function(){history.state&&history.state.__wookie&&(w.trigger(document.documentElement,"popstate"),v({refresh:!0})(function(a){x.trigger(document.documentElement,a,"popstate")}))},!1);p.apply=A;p.request=v;p.queue=function(a){m.push(function(){setTimeout(a,0)});h()};p.loading=w;p.loaded=x;setTimeout(function(){"complete"==document.readyState?n():e.addEventListener?(e.addEventListener("load",n,!1),document.addEventListener("DOMContentLoaded",n,!1)):e.attachEvent&&e.attachEvent("onload",n)},0);"undefined"!=typeof module&&(module.exports=p)})("undefined"==typeof window?self:window);
