(function(d){function q(){var a;if(!v)if(z.length){var b=z.shift();v=!0;wit.apply(b[0],b[1])(function(){v=!1;q();b[2]()})}else if(l.length){var f=l;l=[];for(a=0;a<f.length;a++)f[a]();return q()}}function A(a,b){return function(f){z.push([a,b,f||function(){}]);q()}}function w(a){a=a||{};var b=a.url||location.href;b=b.replace(/#.*$/,"");b=B(b);var f=a.method||"GET";var c=a.headers||{};var e=a.body||null;var G=a.uploadHandler||function(){};var k=a.asynchronous||!1;var h=a.refresh||!1;var n=a.key||{};return function(a){l.push(function(){function q(a){a=a.b;setTimeout(a.onerror,0,Error("Aborted"));a.onload=a.onerror=null;a.abort()}function p(a){a=t.indexOf(a);-1!=a&&t.splice(a,1)}var g,l;a=a||function(){};if(k){var u=t;for(g=0;g<u.length;g++){var r=u[g];if(!r.a){setTimeout(a,0,Error("Aborted"));return}r.key===n&&(p(r),q(r))}}else for(u=t,t=[],g=0;g<u.length;g++)q(u[g]);var m=new XMLHttpRequest;r={b:m,a:k,key:n};t.push(r);G(m.upload);m.onload=function(){p(r);try{var e=JSON.parse(m.responseText)}catch(H){return a(H)}var c=m.responseURL||m.getResponseHeader("X-Response-Url")||b;c=B(c);!k&&d.history&&history.pushState&&history.replaceState&&c!=location.href&&(h?history.replaceState({__wookie:!0},"",c):history.pushState({__wookie:!0},"",c));A(e,void 0)(a)};m.onerror=function(b){p(r);a(b)};m.open(f,b,!0);m.setRequestHeader("Accept","application/json");k&&m.setRequestHeader("X-Async","true");if(d.wok)for(g in wok)if(wok.hasOwnProperty(g))for(l in wok[g])wok[g].hasOwnProperty(l)&&m.setRequestHeader(l,wok[g][l]);for(g in c)c.hasOwnProperty(g)&&m.setRequestHeader(g,c[g]);m.send(e)});q()}}function C(a,b,f,c){var e;for(e=0;e<a.attributes.length;e++){var d=a.attributes[e];var k=d.name.indexOf(b);var h=d.name.indexOf(f);0==k&&h==d.name.length-f.length&&(c[d.name.slice(k+b.length,h)]=d.value)}}function I(a,b,f,c){var e;if(a)var d=[];else if(b||f)var k=new FormData;else return new FormData(c);for(e=0;e<c.elements.length;e++){var h=c.elements[e];if(h.hasAttribute("name"))switch(h.type.toLowerCase()){case "radio":case "checkbox":if(!h.checked)break;default:b&&-1==b.indexOf(h.name)||f&&-1!=f.indexOf(h.name)||(a?d.push(encodeURIComponent(h.name)+(h.value?"="+encodeURIComponent(h.value):"")):k.append(h.name,h.value))}}return a?a.replace(/\?.*$/,"")+"?"+d.join("&"):k}function D(a){var b={};a.preventDefault();C(this,"data-","-header",b);x.trigger(this);w({url:this.href,headers:b,asynchronous:null!=this.getAttribute("data-async")})(function(a){y.trigger(this,a)})}function E(a){var b={};a.preventDefault();C(this,"data-","-header",b);a=this.action||location.href;a=a.replace(/#.*$/,"");if(this.method&&"get"!=this.method.toLowerCase())var d=new FormData(this);else d=null,a=I(a,null,null,this);x.trigger(this);w({url:a,headers:b,method:this.method,body:d,asynchronous:null!=this.getAttribute("data-async")})(function(a){y.trigger(this,a)})}function F(a){var b=a.querySelectorAll("form[data-wk]"),f=a.querySelectorAll("[data-wkrun]");a=a.querySelectorAll("a[data-wk]");var c;for(c=0;c<a.length;c++){var e=a[c];e.addEventListener?e.addEventListener("click",D,!1):e.attachEvent&&e.attachEvent("onclick",D)}if(d.FormData)for(a=0;a<b.length;a++)c=b[a],c.addEventListener?c.addEventListener("submit",E,!1):c.attachEvent&&c.attachEvent("onsubmit",E);for(b=0;b<f.length;b++)if(e=f[b].getAttribute("data-run").split("?"),e[0]){a=e[0].split(".");c={};if(e[1]){var l=e[1].split("&");for(e=0;e<l.length;e++){var k=l[e].split("=");k[0]&&(c[decodeURIComponent(k[0])]=decodeURIComponent(k[1]||""))}}wit.call(a,c,f[b])}}function n(){d.removeEventListener?(d.removeEventListener("load",n,!1),document.removeEventListener("DOMContentLoaded",n,!1)):d.detachEvent&&d.detachEvent("onload",n);wit.beforeMount.subscribe(F);F(document);v=!1;q()}var p=d.wookie=d.wookie||{},z=[],l=[],v=!0,x=wit.event(),y=wit.event(),t=[],B=function(){var a;return function(b){a||(a=document.createElement("a"));a.href=b;return a.href}}();d.addEventListener&&d.addEventListener("popstate",function(){history.state&&history.state.__wookie&&(x.trigger(document.documentElement,"popstate"),w({refresh:!0})(function(a){y.trigger(document.documentElement,a,"popstate")}))},!1);p.apply=A;p.request=w;p.queue=function(a){l.push(function(){setTimeout(a,0)});q()};p.loading=x;p.loaded=y;setTimeout(function(){"complete"==document.readyState?n():d.addEventListener?(d.addEventListener("load",n,!1),document.addEventListener("DOMContentLoaded",n,!1)):d.attachEvent&&d.attachEvent("onload",n)},0);"undefined"!=typeof module&&(module.exports=p)})("undefined"==typeof window?self:window);
