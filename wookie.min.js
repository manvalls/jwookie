(function(h){function q(){var a;if(!B)if(D.length){var c=D.shift();B=!0;wit.apply(c[0],c[1])(function(){B=!1;q();c[2]()})}else if(w.length){var b=w;w=[];for(a=0;a<b.length;a++)b[a]();return q()}}function G(a,c){return function(b){D.push([a,c,b||function(){}]);q()}}function x(a){a=a||{};var c=a.url||location.href;c=c.replace(/#.*$/,"");c=H(c);var b=a.method||"GET";var d=a.headers||{};var e=a.body||null;var k=a.uploadHandler||function(){};var f=a.asynchronous||!1;var g=a.refresh||!1;var I=a.key||{};return function(a){w.push(function(){function n(a){a=a.b;setTimeout(a.onerror,0,Error("Aborted"));a.onload=a.onerror=null;a.abort()}function r(a){a=u.indexOf(a);-1!=a&&u.splice(a,1)}var l,q;a=a||function(){};if(f){var p=u;for(l=0;l<p.length;l++){var t=p[l];if(!t.a){setTimeout(a,0,Error("Aborted"));return}t.key===I&&(r(t),n(t))}}else for(p=u,u=[],l=0;l<p.length;l++)n(p[l]);var m=new XMLHttpRequest;t={b:m,a:f,key:I};u.push(t);k(m.upload);m.onload=function(){r(t);try{var b=JSON.parse(m.responseText)}catch(Q){return a(Q)}var d=m.responseURL||m.getResponseHeader("X-Response-Url")||c;d=H(d);!f&&h.history&&history.pushState&&history.replaceState&&d!=location.href&&(g?history.replaceState({__wookie:!0},"",d):history.pushState({__wookie:!0},"",d));G(b,void 0)(a)};m.onerror=function(b){r(t);a(b)};m.open(b,c,!0);m.setRequestHeader("Accept","application/json");f&&m.setRequestHeader("X-Async","true");if(h.wok)for(l in wok)if(wok.hasOwnProperty(l))for(q in wok[l])wok[l].hasOwnProperty(q)&&m.setRequestHeader(q,wok[l][q]);for(l in d)d.hasOwnProperty(l)&&m.setRequestHeader(l,d[l]);m.send(e)});q()}}function y(a,c,b,d){var e;for(e=0;e<a.attributes.length;e++){var k=a.attributes[e];var f=k.name.indexOf(c);var g=k.name.indexOf(b);0==f&&g==k.name.length-b.length&&(d[k.name.slice(f+c.length,g)]=k.value)}}function J(a){var c;if("select"==a.tagName.toLowerCase()){var b=[];for(c=0;c<a.options.length;c++)a.options[c].selected&&b.push(a.options[c].value);return b}return[a.value]}function C(a,c,b){var d,e;if(a)var k=[];else if(c)var f=new FormData;else return new FormData(b);for(d=0;d<b.elements.length;d++){var g=b.elements[d];if(g.hasAttribute("name"))switch(g.type.toLowerCase()){case "radio":case "checkbox":if(!g.checked)break;default:if(!c||-1!=c.indexOf(g.name)){var h=J(g);for(e=0;e<h.length;e++)a?k.push(encodeURIComponent(g.name)+(h[e]?"="+encodeURIComponent(h[e]):"")):f.append(g.name,h[e])}}}return a?a.replace(/\?.*$/,"")+"?"+k.join("&"):f}function n(a){var c;for(c=0;c<a.length;c++){var b=a[c][0];var d=a[c][1];if(b&&b.hasAttribute(d))return b.getAttribute(d)}return null}function E(a){return null!=a&&"false"!=a.toLowerCase()}function K(a){return a&&"_self"!=a}function R(a){var c={};K(n([[this,"data-target"],[this,"target"]]))||(a.preventDefault(),y(this,"data-","-header",c),z.trigger(this),x({url:n([[this,"data-href"],[this,"href"]]),headers:c,asynchronous:E(this.getAttribute("data-async"))})(function(a){A.trigger(this,a)}))}function S(a){var c={},b=this.__wookie_lastClickedSubmit;if(!K(n([[b,"data-formtarget"],[b,"formtarget"],[this,"data-target"],[this,"target"]]))){y(this,"data-","-header",c);b&&y(b,"data-","-header",c);var d=n([[b,"data-formmethod"],[b,"formmethod"],[this,"data-method"],[this,"method"]])||"GET";var e=n([[b,"data-formaction"],[b,"formaction"],[this,"data-action"],[this,"action"]])||location.href;e=e.replace(/#.*$/,"");if("get"==d.toLowerCase()){var k=null;e=C(e,null,this)}else{if(!h.FormData)return;var f=n([[b,"data-formenctype"],[b,"formenctype"],[this,"data-enctype"]]);if(null!=f){var g=this.encoding;this.encoding=f}k=C(null,null,this);null!=f&&(this.encoding=g)}a.preventDefault();z.trigger([this]);x({url:e,headers:c,method:d,body:k,asynchronous:E(n([[b,"data-async"],[this,"data-async"]]))})(function(a){A.trigger([this],a)})}}function T(){this.form&&(this.form.__wookie_lastClickedSubmit=this)}function U(){L.call(this)}function L(){this.__wookie_committed=!0;F(this,!1)}function M(a){return null!=a.getAttribute("data-commitonly")||null!=a.getAttribute("data-waitcommit")&&!a.__wookie_committed?!1:!0}function V(){M(this)&&F(this,!1)}function W(a,c){var b;if(a===c)return!0;if(!a||!c||a.length!=c.length)return!1;for(b=0;b<a.length;b++)if(a[b]!==c[b])return!1;return!0}function N(a){var c=[],b;for(b in a)a.hasOwnProperty(b)&&c.push(b);return c}function O(a){a=a.getAttribute("data-dependencies");var c,b;if(null==a)return[];a=a.split(/\s+/);var d=[];for(c=0;c<a.length;c++)(b=decodeURIComponent(a[c]))&&d.push(b);return d}function F(a,c){var b,d;clearTimeout(a.__wookie_debounceTimeout);delete a.__wookie_debounceTimeout;if((b=a.getAttribute("data-debounce")||a.form&&a.form.getAttribute("data-debounce"))&&!c)a.__wookie_debounceTimeout=setTimeout(F,parseInt(b,10),a,!0);else if(b=J(a),(a.__wookie_lastChecked!==a.checked||!W(a.__wookie_lastValues,b))&&a.form&&a.name){a.__wookie_lastChecked=a.checked;a.__wookie_lastValues=b;var e={};b={};var k=[a];e[a.name]=!0;b[a.name]=!0;var f=O(a);for(d=0;d<f.length;d++)e[f[d]]=!0;for(d=0;d<a.form.elements.length;d++){var g=a.form.elements[d];if(null!=g.getAttribute("data-wk")&&g.name&&M(g)&&(f=O(g),-1!=f.indexOf(a.name)))for(-1==k.indexOf(g)&&k.push(g),e[g.name]=!0,b[g.name]=!0,g=0;g<f.length;g++)e[f[g]]=!0}e=N(e);d=N(b);b={};b["X-Live"]=d.join(",");y(a.form,"data-","-header",b);y(a.form,"data-","-liveheader",b);d=n([[a.form,"data-livemethod"],[a.form,"data-method"],[a.form,"method"]])||"GET";f=n([[a.form,"data-liveaction"],[a.form,"data-action"],[a.form,"action"]])||location.href;f=f.replace(/#.*$/,"");if("get"==d.toLowerCase())g=null,f=C(f,e,a.form);else{if(!h.FormData)return;g=C(null,e,a.form)}z.trigger(k);x({url:f,headers:b,method:d,body:g,asynchronous:E(n([[a.form,"data-liveasync"],[a.form,"data-async"]]))})(function(a){A.trigger(k,a)})}}function p(a,c,b){var d;for(d=0;d<a.length;d++){var e=a[d];e.addEventListener?e.addEventListener(c,b,!1):e.attachEvent&&e.attachEvent("on"+c,b)}}function P(a){var c=a.querySelectorAll("form[data-wk]"),b=a.querySelectorAll("input[type=submit], button[type=submit], input[type=image]"),d=a.querySelectorAll("input[data-wk], textarea[data-wk], select[data-wk]"),e=a.querySelectorAll("[data-wkrun]");p(a.querySelectorAll("a[data-wk]"),"click",R);p(c,"submit",S);p(b,"click",T);p(d,"blur",L);p(d,"change",U);p(d,"input",V);for(a=0;a<e.length;a++)if(d=e[a].getAttribute("data-run").split("?"),d[0]){c=d[0].split(".");b={};if(d[1]){var h=d[1].split("&");for(d=0;d<h.length;d++){var f=h[d].split("=");f[0]&&(b[decodeURIComponent(f[0])]=decodeURIComponent(f[1]||""))}}wit.call(c,b,e[a])}}function r(){h.removeEventListener?(h.removeEventListener("load",r,!1),document.removeEventListener("DOMContentLoaded",r,!1)):h.detachEvent&&h.detachEvent("onload",r);wit.beforeMount.subscribe(P);P(document);B=!1;q()}var v=h.wookie=h.wookie||{},D=[],w=[],B=!0,z=wit.event(),A=wit.event(),u=[],H=function(){var a;return function(c){a||(a=document.createElement("a"));a.href=c;return a.href}}();h.addEventListener&&h.addEventListener("popstate",function(){history.state&&history.state.__wookie&&(z.trigger(document.documentElement,"popstate"),x({refresh:!0})(function(a){A.trigger(document.documentElement,a,"popstate")}))},!1);v.apply=G;v.request=x;v.queue=function(a){w.push(function(){setTimeout(a,0)});q()};v.loading=z;v.loaded=A;setTimeout(function(){"complete"==document.readyState?r():h.addEventListener?(h.addEventListener("load",r,!1),document.addEventListener("DOMContentLoaded",r,!1)):h.attachEvent&&h.attachEvent("onload",r)},0);"undefined"!=typeof module&&(module.exports=v)})("undefined"==typeof window?self:window);
